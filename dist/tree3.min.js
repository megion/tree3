/*!
 * tree3
 * https://github.com/megion/tree3
 * Version: 0.0.1 - 2015-05-15T12:05:33.029Z
 * License: MIT
 */
var tree3={};tree3.stopEventPropagation=function(e){e?e.stopPropagation&&e.stopPropagation():window.event.cancelBubble=!0},tree3.addClass=function(e,t){var o=" "+e.className+" ";-1==o.indexOf(" "+t+" ")&&(e.className=e.className+" "+t)},tree3.removeClass=function(e,t){var o=" "+e.className+" ",r=o.replace(" "+t,"").trim();e.className!=r&&(e.className=r)},tree3.addClasses=function(e,t){for(var o=" "+e.className+" ",r="",l=0;l<t.length;l++){var n=t[l];-1==o.indexOf(" "+n+" ")&&(r+=" "+n)}r.length>0&&(e.className=e.className+r)},tree3.removeClasses=function(e,t){for(var o=" "+e.className+" ",r=0;r<t.length;r++){var l=t[r];o=o.replace(" "+l,"")}var n=o.trim();e.className!=n&&(e.className=n)},tree3.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},tree3.AbstractTreeControl=function(e,t){this.id=e,this.treeEl=t,this.treeEl.treeControl=this,this.currentSelectedNodeEl=null,this.allNodesMap={}},tree3.AbstractTreeControl.TREE_CLASSES={selectedNode:"selected",treeNode:"menu",closed:"closed",closedHitarea:"closed-hitarea",lastClosed:"lastClosed",lastClosedHitarea:"lastClosed-hitarea",opened:"opened",openedHitarea:"opened-hitarea",lastOpened:"lastOpened",lastOpenedHitarea:"lastOpened-hitarea",hitarea:"hitarea",firstTdInner:"firstTdInner"},tree3.AbstractTreeControl.onClickTreeNode=function(e){tree3.stopEventPropagation(e);var t=this,o=t.treeControl;return o.clickNode(t),!1},tree3.AbstractTreeControl.prototype.configure=function(e){this.conf=e||{},this.disableHistory=this.conf.disableHistory},tree3.AbstractTreeControl.prototype.clickNode=function(e,t){if((void 0===t||null===t)&&(t=null==e.opened?!1:e.opened),this.disableHistory)this.selectTreeNode(e,t);else{e.opened=!t;var o=this.getNodeHash(e),r=decodeURIComponent(location.hash.slice(1)),l=tree3.historyMaster.putValue(this.id,o,r);jQuery.history.load(l)}},tree3.AbstractTreeControl.prototype.processAllNodes=function(e){for(var t in this.allNodesMap){var o=this.allNodesMap[t],r=o.nodeEl;e.call(this,r)}},tree3.AbstractTreeControl.prototype.loadChildNodes=function(){console.error("Function loadChildNodes should be overriden")},tree3.AbstractTreeControl.prototype.loadTreeScopeNodes=function(){console.error("Function loadTreeScopeNodes should be overriden")},tree3.AbstractTreeControl.prototype.setSelectionTreeNode=function(){console.error("Function setSelectionTreeNode should be overriden")},tree3.AbstractTreeControl.prototype.processAllParentNode=function(e,t,o){if(o&&t.call(this,e),e.parentId){var r=this.allNodesMap[e.parentId];this.processAllParentNode(r,t,!0)}},tree3.AbstractTreeControl.prototype.processAllChildrenNode=function(e,t,o,r){if(o){var l=t(e,r);if(!l)return}if(e.children)for(var n=0;n<e.children.length;n++){var d=e.children[n];this.processAllChildrenNode(d,t,!0,r++)}},tree3.AbstractTreeControl.prototype.selectTreeNode=function(e,t){this.setSelectionTreeNode(e),this.setNodeClose(e,t);var o=e.nodeModel.needLoad;o&&this.loadChildNodes(e)},tree3.AbstractTreeControl.prototype.setNodeClose=function(e,t){var o=tree3.AbstractTreeControl.TREE_CLASSES,r=e.hasChildren;if(e.opened=!t,r){var l=e.isLast;l&&(t?(tree3.addClass(e,o.lastClosed),tree3.removeClass(e,o.lastOpened)):(tree3.addClass(e,o.lastOpened),tree3.removeClass(e,o.lastClosed))),t?(tree3.addClass(e,o.closed),tree3.removeClass(e,o.opened)):(tree3.addClass(e,o.opened),tree3.removeClass(e,o.closed)),l&&(t?(tree3.addClass(e.hitareaDiv,o.lastClosedHitarea),tree3.removeClass(e.hitareaDiv,o.lastOpenedHitarea)):(tree3.addClass(e.hitareaDiv,o.lastOpenedHitarea),tree3.removeClass(e.hitareaDiv,o.lastClosedHitarea))),t?(tree3.addClass(e.hitareaDiv,o.closedHitarea),tree3.removeClass(e.hitareaDiv,o.openedHitarea)):(tree3.addClass(e.hitareaDiv,o.openedHitarea),tree3.removeClass(e.hitareaDiv,o.closedHitarea))}},tree3.AbstractTreeControl.prototype.openNode=function(e,t){this.processAllParentNode(e.nodeModel,function(e){e.nodeEl.opened||this.setNodeClose(e.nodeEl,!1)},!1),this.selectTreeNode(e,t)},tree3.AbstractTreeControl.prototype.getNodeHash=function(e){var t=e.nodeModel.id;return null==e.opened||e.opened||(t+="&state=closed"),"id-"+t},tree3.AbstractTreeControl.prototype.getNodeInfoByAnchor=function(e){var t=e.split("&"),o=t.shift(),r=!1;if(t.length){var l=t.shift();"state=closed"==l&&(r=!0)}var n=o.substring(o.indexOf("-")+1,o.length),d={nodeId:n,setClosed:r};return d},tree3.AbstractTreeControl.prototype.detectAnchor=function(e){e&&this.updateTreeStateByAnchor(e,!1)},tree3.AbstractTreeControl.prototype.updateTreeStateByAnchor=function(e,t){var o=tree3.historyMaster.getValue(this.id,decodeURIComponent(e));if(o){var r=this.getNodeInfoByAnchor(o),l=this.allNodesMap[r.nodeId];l&&!l.fakeNode?this.openNode(l.nodeEl,r.setClosed):this.loadTreeScopeNodes(r.nodeId,r.setClosed,t)}},tree3.AbstractTreeControl.prototype.updateState=function(){var e=location.hash.slice(1);this.updateTreeStateByAnchor(e,!0)},tree3.AbstractTreeControl.prototype.removeState=function(){if(!this.disableHistory){var e=decodeURIComponent(location.hash.slice(1)),t=tree3.historyMaster.removeValue(this.id,e);jQuery.history.load(t)}},tree3.AbstractTreeControl.prototype.updateLinkInParentChildren=function(e){if(e.parentId){var t=this.allNodesMap[e.parentId];if(t.children)for(var o=0;o<t.children.length;o++){var r=t.children[o];if(r.id==e.id)return t.children[o]=e,void 0}}},tree3.TreeControl=function(){tree3.AbstractTreeControl.apply(this,arguments)},tree3.TreeControl.prototype=Object.create(tree3.AbstractTreeControl.prototype),tree3.TreeControl.prototype.init=function(e){this.appendNewNodes(this.treeEl,e)},tree3.TreeControl.prototype.updateRootNodes=function(e,t){this.updateExistUlNodesContainer(this.treeEl,e,t)},tree3.TreeControl.prototype.updateExistUlNodesContainer=function(e,t,o){var r=null;if(e&&(r=e.nodeModels,e.nodeModels=t),null!==t&&0!==t.length){for(var l,n={},d=0;d<t.length;d++)l=t[d],n[l.id]=l;var s,a={};for(d=0;d<r.length;d++)s=r[d],null==n[s.id]?this.deleteExistSubNode(e,s):a[s.id]=s;var i=null;for(d=0;d<t.length;d++){l=t[d];var c;if(c=d==t.length-1?!0:!1,s=a[l.id]){if(d<r.length){var p=r[d];p.id==l.id||this.moveToAfterExistSubNode(e,s,i)}else this.moveToEndExistSubNode(e,s);this.updateExistNode(s,l,o)}else this.appendNewNode(e,l);l.nodeEl.isLast=c,i=l}}else if(null!=r&&r.length>0)for(var h=0;h<r.length;h++){var u=r[h];this.deleteExistSubNode(e,u)}},tree3.TreeControl.prototype.updateLoadedNode=function(e,t){this.updateExistNode(e,t,!1),this.updateLinkInParentChildren(t)},tree3.TreeControl.prototype.updateExistNode=function(e,t,o){var r=e.nodeEl,l=e.children,n=t.children;t.nodeEl=r,r.nodeModel=t,this.allNodesMap[t.id]=t,this.updateNodeAppearance(r,t);var d=null!=n&&n.length>0,s=null!=l&&l.length>0;if(s){if(!d){for(var a=0;a<l.length;a++){var i=l[a];this.deleteExistSubNode(r.subnodesUl,i)}return this.enableChildren(r,!1),void 0}r.hasChildren=!0}else if(d)return this.enableChildren(r,!0),o&&this.currentSelectedNodeEl&&this.currentSelectedNodeEl.nodeModel.id==t.id&&r.opened&&this.setNodeClose(r,!1),this.appendNewNodes(r.subnodesUl,n),void 0;o&&r.nodeModel.needLoad&&this.setNodeClose(r,!0),this.updateExistUlNodesContainer(r.subnodesUl,n,o)},tree3.TreeControl.prototype.enableChildren=function(e,t){if(t){var o=document.createElement("div");o.className=tree3.AbstractTreeControl.TREE_CLASSES.hitarea+" "+tree3.AbstractTreeControl.TREE_CLASSES.closedHitarea,e.insertBefore(o,e.firstChild),e.hitareaDiv=o,e.hasChildren=!0;var r=document.createElement("ul");r.style.display="none",e.appendChild(r),e.subnodesUl=r}else e.removeChild(e.subnodesUl),e.subnodesUl=null,e.removeChild(e.hitareaDiv),e.hitareaDiv=null,e.hasChildren=!1},tree3.TreeControl.prototype.createNodeAppearance=function(e,t){var o=document.createElement("span");o.className=tree3.AbstractTreeControl.TREE_CLASSES.treeNode,o.innerHTML=t.title,e.appendChild(o),e.nodeSpan=o},tree3.TreeControl.prototype.updateNodeAppearance=function(e,t){var o=e.nodeSpan;o.innerHTML=t.title},tree3.TreeControl.prototype.appendNewNode=function(e,t){var o=document.createElement("li");o.onclick=tree3.AbstractTreeControl.onClickTreeNode,e.appendChild(o);var r=t.children,l=null!=r&&r.length>0;if(o.treeControl=this,o.nodeModel=t,t.nodeEl=o,this.createNodeAppearance(o,t),this.allNodesMap[t.id]=t,l){this.enableChildren(o,!0);var n=o.subnodesUl;this.appendNewNodes(n,r)}return o},tree3.TreeControl.prototype.appendNewNodes=function(e,t){e.nodeModels=t;for(var o=0;o<t.length;o++){var r,l=t[o];r=o==t.length-1?!0:!1,this.appendNewNode(e,l),l.nodeEl.isLast=r}},tree3.TreeControl.prototype.deleteExistSubNode=function(e,t){var o=t.nodeEl,r=t.children;if(null!=r&&r.length>0)for(var l=o.subnodesUl,n=0;n<r.length;n++){var d=r[n];this.deleteExistSubNode(l,d)}this.currentSelectedNodeEl&&this.currentSelectedNodeEl.nodeModel.id==t.id&&(this.clearSelectionTreeNode(),this.removeState()),o.nodeModel=null,t.nodeEl=null,delete this.allNodesMap[t.id],e.removeChild(o)},tree3.TreeControl.prototype.moveToEndExistSubNode=function(e,t){var o=t.nodeEl;e.appendChild(o)},tree3.TreeControl.prototype.moveToAfterExistSubNode=function(e,t,o){var r=t.nodeEl;o?tree3.insertAfter(r,o.nodeEl):e.insertBefore(r,e.firstChild)},tree3.TreeControl.prototype.setSelectionTreeNode=function(e){var t=tree3.AbstractTreeControl.TREE_CLASSES;this.currentSelectedNodeEl&&tree3.removeClass(this.currentSelectedNodeEl.nodeSpan,t.selectedNode),this.currentSelectedNodeEl=e,tree3.addClass(this.currentSelectedNodeEl.nodeSpan,t.selectedNode)},tree3.TreeControl.prototype.clearSelectionTreeNode=function(){var e=tree3.AbstractTreeControl.TREE_CLASSES;this.currentSelectedNodeEl&&tree3.removeClass(this.currentSelectedNodeEl.nodeSpan,e.selectedNode),this.currentSelectedNodeEl=null},tree3.TreeControl.prototype.selectTreeNode=function(e,t){this.setSelectionTreeNode(e),this.setNodeClose(e,t);var o=e.nodeModel.needLoad;o&&this.loadChildNodes(e)},tree3.TreeControl.prototype.setNodeClose=function(e,t){tree3.AbstractTreeControl.prototype.setNodeClose.apply(this,arguments);var o=e.hasChildren;o&&(e.subnodesUl.style.display=t?"none":"block")},tree3.TreetableControl=function(){tree3.AbstractTreeControl.apply(this,arguments)},tree3.TreetableControl.prototype=Object.create(tree3.AbstractTreeControl.prototype),tree3.TreetableControl.prototype.init=function(e){var t=this.treeEl.tBodies;t&&t.length>0?this.tableBodyEl=t[0]:(this.tableBodyEl=document.createElement("tbody"),this.treeEl.appendChild(this.tableBodyEl)),this.rootNodes=e,this.appendNewNodes(e,0,null);for(var o=0;o<e.length;o++){var r=e[o];r.nodeEl.style.display=null}},tree3.TreetableControl.prototype.appendNewNodes=function(e,t,o){for(var r=0;r<e.length;r++){var l,n=e[r];l=r==e.length-1?!0:!1,this.appendNewNode(n,t,o),n.nodeEl.isLast=l}},tree3.TreetableControl.prototype.appendNewNode=function(e,t,o){var r=document.createElement("tr");r.onclick=tree3.AbstractTreeControl.onClickTreeNode,o&&o.prevNode?tree3.insertAfter(r,o.prevNode.nodeEl):this.tableBodyEl.appendChild(r),o||(o={}),o.prevNode=e;var l=e.children,n=null!=l&&l.length>0,d=document.createElement("td");r.appendChild(d);var s=document.createElement("div");s.style.marginLeft=20*t+"px",s.className=tree3.AbstractTreeControl.TREE_CLASSES.firstTdInner,d.appendChild(s);var a=document.createElement("span");return a.className=tree3.AbstractTreeControl.TREE_CLASSES.treeNode,a.innerHTML=e.title,s.appendChild(a),r.nodeSpan=a,r.treeControl=this,r.level=t,r.firstTdInnerDiv=s,r.nodeModel=e,e.nodeEl=r,r.style.display="none",this.allNodesMap[e.id]=e,n&&(this.enableChildren(r,!0),this.appendNewNodes(l,t+1,o)),r},tree3.TreetableControl.prototype.enableChildren=function(e,t){if(t){var o=document.createElement("div");o.className=tree3.AbstractTreeControl.TREE_CLASSES.hitarea+" "+tree3.AbstractTreeControl.TREE_CLASSES.closedHitarea,e.firstTdInnerDiv.insertBefore(o,e.nodeSpan),e.hitareaDiv=o,e.hasChildren=!0}else e.firstTdInnerDiv.removeChild(e.hitareaDiv),e.hitareaDiv=null,e.hasChildren=!1},tree3.TreetableControl.prototype.updateRootNodes=function(e,t){this.updateNodes(e,this.rootNodes,t,0,null),this.newRootNodes=e},tree3.TreetableControl.prototype.updateNodes=function(e,t,o,r,l){if(null!=e&&0!==e.length){for(var n,d,s={},a=0;a<e.length;a++)n=e[a],s[n.id]=n;var i={};for(a=0;a<t.length;a++)d=t[a],null==s[d.id]?this.deleteExistNode(d):i[d.id]=d;var c=null;for(a=0;a<e.length;a++){n=e[a];var p;if(p=a==e.length-1?!0:!1,d=i[n.id]){if(a<t.length){var h=t[a];h.id==n.id||this.moveToAfterExistSubNode(d,c,t[0])}else this.moveToEndExistSubNode(d,c);this.updateExistNode(d,n,o)}else this.appendNewNode(n,r,l);n.nodeEl.isLast=p,c=n}}else if(null!=t&&t.length>0)for(var u=0;u<t.length;u++)this.deleteExistNode(t[u])},tree3.TreetableControl.prototype.moveToAfterExistSubNode=function(e,t,o){var r=e.nodeEl;t?tree3.insertAfter(r,t.nodeEl):this.tableBodyEl.insertBefore(r,o.nodeEl)},tree3.TreetableControl.prototype.moveToEndExistSubNode=function(e,t){var o=e.nodeEl;tree3.insertAfter(o,t.nodeEl)},tree3.TreetableControl.prototype.deleteExistNode=function(e){var t=e.nodeEl,o=e.children;if(null!=o&&o.length>0)for(var r=0;r<o.length;r++){var l=o[r];this.deleteExistNode(l)}this.currentSelectedNodeEl&&this.currentSelectedNodeEl.nodeModel.id==e.id&&(this.clearSelectionTreeNode(),this.removeState()),t.nodeModel=null,e.nodeEl=null,t.hitareaDiv=null,t.nodeSpan=null,t.firstTdInnerDiv=null,t.treeControl=null,delete this.allNodesMap[e.id],this.tableBodyEl.removeChild(t)},tree3.TreetableControl.prototype.updateExistNode=function(e,t,o){var r=e.nodeEl,l=e.children,n=t.children;t.nodeEl=r,r.nodeModel=t,this.allNodesMap[t.id]=t,this.updateVisualNodeEl(r,t);var d=null!=n&&n.length>0,s=null!=l&&l.length>0;if(s){if(!d){for(var a=0;a<l.length;a++){var i=l[a];this.deleteExistNode(i)}return this.enableChildren(r,!1),void 0}r.hasChildren=!0}else if(d)return this.enableChildren(r,!0),o&&this.currentSelectedNodeEl&&this.currentSelectedNodeEl.nodeModel.id==newNodeModel.id&&r.opened&&this.setNodeClose(r,!1),this.appendNewNodes(n,r.level+1,{prevNode:t}),void 0;o&&r.nodeModel.needLoad&&this.setNodeClose(r,!0),this.updateNodes(n,l,o,r.level+1,{prevNode:t})},tree3.TreetableControl.prototype.updateLoadedNode=function(e,t){this.updateExistNode(e,t,!1),this.updateLinkInParentChildren(t)},tree3.TreetableControl.prototype.updateVisualNodeEl=function(e,t){var o=e.nodeSpan;o.innerHTML=t.title},tree3.TreetableControl.prototype.setSelectionTreeNode=function(e){var t=tree3.AbstractTreeControl.TREE_CLASSES;this.currentSelectedNodeEl&&tree3.removeClass(this.currentSelectedNodeEl.nodeSpan,t.selectedNode),this.currentSelectedNodeEl=e,tree3.addClass(this.currentSelectedNodeEl.nodeSpan,t.selectedNode)},tree3.TreetableControl.prototype.clearSelectionTreeNode=function(){var e=tree3.AbstractTreeControl.TREE_CLASSES;this.currentSelectedNodeEl&&tree3.removeClass(this.currentSelectedNodeEl.nodeSpan,e.selectedNode),this.currentSelectedNodeEl=null},tree3.TreetableControl.prototype.selectTreeNode=function(e,t){this.setSelectionTreeNode(e),this.setNodeClose(e,t);var o=e.nodeModel.needLoad;o&&this.loadChildNodes(e)},tree3.TreetableControl.prototype.setNodeClose=function(e,t){tree3.AbstractTreeControl.prototype.setNodeClose.apply(this,arguments);var o=e.hasChildren;o&&this.processAllChildrenNode(e.nodeModel,function(e){return t?(e.nodeEl.style.display="none",!0):(e.nodeEl.style.display=null,e.nodeEl.opened?!0:!1)},!1,0)};